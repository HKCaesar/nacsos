{% extends "parliament/base.html" %}
{% load render_table from django_tables2 %}
{% block content %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>


<h2>{{topic.title}}</h2>
<h3>{{topic.top_words}}</h3>

<svg id="chartarea"></svg>

{% render_table pars %}

<!-- <svg width="960" height="500"></svg> -->

<p>Topic {{stat.pk}}:


{% endblock %}



{% block script %}
<script type="text/javascript">

var data = {{graph|safe}};

console.log(data)


for (i=0;i<data.length;i++) {
    data[i].n = i
}


var height = 400;
var width = 600;
var barPadding = 2;
var barWidth = (width / data.length) - barPadding;

console.log(d3.max(data, function(d){return d.topic_score}))

var yScale = d3.scale.linear()
	.domain([0, d3.max(data, function(d){return d.topic_score})])
	.range([0, height]);

var xScale = d3.scale.ordinal()
	.domain(data.n)
	.rangeBands([0, width], 0.1, 0.3);

var svg = d3.select("#chartarea")
	.style('width', width + 'px')
	.style('height', height + 'px');

svg.selectAll('rect')
	.data(data)
	.enter()
	.append('rect')
	.attr('class', 'bar')
	.attr("x", function (d, i) {
		return xScale(i);
	})
	.attr("y", function (d, i) {
		return height;
	})
	.attr("width", function (d, i) {
		return xScale.rangeBand()
	})
	.attr("fill", function (d) {
		return d.utterance__speaker__party__colour
	})
	.attr("height", 0)
	.transition()
	.duration(200)
	.delay(function (d, i) {
		return i * 50;
	})
	.attr("y", function (d, i) {
		return height - yScale(d.topic_score);
	})
	.attr("height", function (d, i) {
		return yScale(d.topic_score);
	});

</script>
{% endblock %}
